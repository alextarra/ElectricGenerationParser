@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<div class="text-center">
    <h1 class="display-4">Electric Generation Parser</h1>
    <p>Upload your generation data to process the report.</p>

    <div class="row justify-content-center mt-5">
        <div class="col-md-6">
            <form method="post" enctype="multipart/form-data">
                <div class="form-group mb-3">
                    <label for="fileUpload" class="form-label">Select CSV File</label>
                    <input type="file" class="form-control" id="fileUpload" name="Upload" accept=".csv" required>
                </div>
                <button type="submit" class="btn btn-primary">Process Report</button>
            </form>
            <div asp-validation-summary="ModelOnly" class="text-danger mt-2"></div>
        </div>
    </div>
</div>

@if (Model.Report != null)
{
    <hr class="my-5" />

    <div class="container">
        <h2 class="mb-4">Generation Report</h2>

        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Period</th>
                    <th class="text-end">Produced</th>
                    <th class="text-end">Consumed</th>
                    <th class="text-end">Export</th>
                    <th class="text-end">Import</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>On-Peak</td>
                    <td class="text-end">@Model.Report.TotalOnPeak.Produced.ToString("N2")</td>
                    <td class="text-end">@Model.Report.TotalOnPeak.Consumed.ToString("N2")</td>
                    <td class="text-end">@Model.Report.TotalOnPeak.Export.ToString("N2")</td>
                    <td class="text-end">@Model.Report.TotalOnPeak.Import.ToString("N2")</td>
                </tr>
                <tr>
                    <td>Off-Peak</td>
                    <td class="text-end">@Model.Report.TotalOffPeak.Produced.ToString("N2")</td>
                    <td class="text-end">@Model.Report.TotalOffPeak.Consumed.ToString("N2")</td>
                    <td class="text-end">@Model.Report.TotalOffPeak.Export.ToString("N2")</td>
                    <td class="text-end">@Model.Report.TotalOffPeak.Import.ToString("N2")</td>
                </tr>
                <tr class="table-primary fw-bold">
                    <td>Grand Total</td>
                    <td class="text-end">@Model.Report.GrandTotal.Produced.ToString("N2")</td>
                    <td class="text-end">@Model.Report.GrandTotal.Consumed.ToString("N2")</td>
                    <td class="text-end">@Model.Report.GrandTotal.Export.ToString("N2")</td>
                    <td class="text-end">@Model.Report.GrandTotal.Import.ToString("N2")</td>
                </tr>
            </tbody>
        </table>

        @if (Model.Report.WeekendTotal != null)
        {
            <h3 class="mt-5 mb-3">Weekend Totals</h3>
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th class="text-end">Value</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Produced</td>
                        <td class="text-end">@Model.Report.WeekendTotal.Produced.ToString("N2")</td>
                    </tr>
                    <tr>
                        <td>Consumed</td>
                        <td class="text-end">@Model.Report.WeekendTotal.Consumed.ToString("N2")</td>
                    </tr>
                    <tr>
                        <td>Export</td>
                        <td class="text-end">@Model.Report.WeekendTotal.Export.ToString("N2")</td>
                    </tr>
                    <tr>
                        <td>Import</td>
                        <td class="text-end">@Model.Report.WeekendTotal.Import.ToString("N2")</td>
                    </tr>
                </tbody>
            </table>
        }

        @if (Model.Report.HolidaySummaries != null && Model.Report.HolidaySummaries.Any())
        {
            <h3 class="mt-5 mb-3">Holiday Breakdowns</h3>
            @foreach (var kvp in Model.Report.HolidaySummaries)
            {
                var date = kvp.Key;
                var summary = kvp.Value;
                <h4 class="mt-4">@summary.Name (@date.ToString("yyyy-MM-dd"))</h4>
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th class="text-end">Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Produced</td>
                            <td class="text-end">@summary.Produced.ToString("N2")</td>
                        </tr>
                        <tr>
                            <td>Consumed</td>
                            <td class="text-end">@summary.Consumed.ToString("N2")</td>
                        </tr>
                        <tr>
                            <td>Export</td>
                            <td class="text-end">@summary.Export.ToString("N2")</td>
                        </tr>
                        <tr>
                            <td>Import</td>
                            <td class="text-end">@summary.Import.ToString("N2")</td>
                        </tr>
                    </tbody>
                </table>
            }
        }
    </div>
}
